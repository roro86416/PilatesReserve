`此為2025/7 - 2025/11 資策會培訓期間所製作的個人專案一`

# PilatesReserve 專題開發筆記

## 預計功能目標

### 一、 會員端

- **線上預約課程**：快速選擇適合我的時段與老師。
- **預約提醒功能**：不會忘記上課時間。
- **預約取消或改期功能**：靈活調整行程。

### 二、 教練端

- **設定或更改開課時段的功能**：自主安排上課時間。
- **查看自己課表與預約名單的功能**：清楚知道每天的上課安排。
- **核銷課程**：確認已完成上課。
- **對學員進行標籤的功能**：標記需特別注意的學員（如黑名單、我的最愛）。

---

## 目前開發進度

- **前端視覺**：已完成簡易前端的視覺。
- **會員端功能**：
  - 基本的會員登入。
  - 查看會員登入後的會員資料。
  - 查看個人資料以及預約課表清單 (READ)。
  - 更改/刪除預約 (UPDATE / 軟刪除)。
  - 新增預約 (CREATE)。
- **教練端功能**：目前為無。

---

## 技術實作說明

### 1. 登入系統邏輯

目前 CRUD 部分參考新德老師教導的語法製作。

| 功能             | 實作細節                                                  | 備註                                                        |
| :--------------- | :-------------------------------------------------------- | :---------------------------------------------------------- |
| **登入處理**     | 在主程式中解析 JSON 數據，使用 `POST /login` 執行。       | `SELECT id, name FROM members WHERE email=? AND password=?` |
| **Session 建立** | 查有資料後，將 `id` 與 `name` 存入 `req.session.member`。 | 使用 `express-session` 生成 `connect.sid` cookie。          |
| **安全性**       | 透過 `?` 帶入參數，避免 **SQL Injection** 風險。          | **待改進**：尚未對密碼使用雜湊、未設置 `httpOnly`。         |
| **登出**         | 銷毀 Session (`req.session.destroy`) 並重導向到首頁。     |                                                             |

### 2. 登入狀態與導覽列呈現

透過 `express-session` 管理，並在 `app.js` 中定義：

> `res.locals.session = req.session`

- **呈現邏輯**：在 `html-navbar.ejs` 中使用 `if...else` 語法。
- **顯示規則**：若 `session && session.member` 存在則呈現頭像，否則顯示登入按鈕。

### 3. 路由保護機制 (requireMember)

在會員資料相關路由中：

1.  讀取 `session.member` 並宣告為 `mid` (memberid) 參數。
2.  **安全機制**：如果沒讀到 session 就請使用者返回登入頁面。
